var qrCodeScanner=function(){"use strict";var e={version:"1.0.1",loader:{start:function(e){try{apex.util.showSpinner($(e))}catch(a){var r=$("<span></span>");r.attr("id","loader"+e),r.addClass("ct-loader fa-stack fa-3x");var o=$("<i></i>");o.addClass("fa fa-circle fa-stack-2x"),o.css("color","rgba(121,121,121,0.6)");var t=$("<i></i>");t.addClass("fa fa-refresh fa-spin fa-inverse fa-stack-1x"),t.css("animation-duration","1.8s"),r.append(o),r.append(t),$(e).append(r)}},stop:function(e){$(e+" > .u-Processing").remove(),$(e+" > .ct-loader").remove()}},jsonSaveExtend:function(e,r){var o={};if("string"==typeof r)try{r=JSON.parse(r)}catch(e){console.error("Error while try to parse udConfigJSON. Please check your Config JSON. Standard Config will be used."),console.error(e),console.error(r)}else o=r;try{o=$.extend(!0,e,r)}catch(r){console.error("Error while try to merge udConfigJSON into Standard JSON if any attribute is missing. Please check your Config JSON. Standard Config will be used."),console.error(r),o=e,console.error(o)}return o}};return{initialize:function(r,o,t,a,n){function i(e,r,o){g.beginPath(),g.moveTo(e.x,e.y),g.lineTo(r.x,r.y),g.lineWidth=4,g.strokeStyle=o,g.stroke()}function c(){if(d.readyState===d.HAVE_ENOUGH_DATA){var o=d.videoWidth/d.videoHeight;isNaN(o)&&(o=d.width/d.height),isNaN(o)&&(o=4/3),e.loader.stop("#"+r),h.height=l.height,h.width=l.height*o,g.drawImage(d,0,0,Math.floor(h.width),Math.floor(h.height));var f=g.getImageData(0,0,Math.floor(h.width),Math.floor(h.height)),u=jsQR(f.data,f.width,f.height,{inversionAttempts:"dontInvert"});if(u&&(i(u.location.topLeftCorner,u.location.topRightCorner,l.scanFrameColor),i(u.location.topRightCorner,u.location.bottomRightCorner,l.scanFrameColor),i(u.location.bottomRightCorner,u.location.bottomLeftCorner,l.scanFrameColor),i(u.location.bottomLeftCorner,u.location.topLeftCorner,l.scanFrameColor),s.length!=u.data.length)){switch(t){case"1":try{new Function("scannedValue",a)(u.data)}catch(e){console.error("Error while execute JavaScript Code!"),console.error(e)}break;case"2":try{var p=u.data;p&&p.length>0&&!isNaN(p)&&(p=(p=parseFloat(p)).toLocaleString(apex.locale.getLanguage())),apex.item(n).setValue(p)}catch(e){console.error("Error while try to set APEX Item!"),console.error(e)}break;case"3":apex.event.trigger("#"+r,"qr-code-scanned",u.data);break;default:console.error("SetMode not found!")}s=u.data}}try{requestAnimationFrame(c)}catch(e){console.error("Error while try to scan QR Code"),console.error(e)}}$("#"+r).css("min-height","140px"),e.loader.start("#"+r);var s="",l=e.jsonSaveExtend({height:360,scanFrameColor:"rgba(192,0,15,1)",facingMode:"environment"},o);try{var d=document.createElement("video"),h=document.createElement("canvas");h.style.display="block",h.style.margin="5px auto";var g=h.getContext("2d");$("#"+r).append(h)}catch(e){console.error("Error while try to create canvas for video frame"),console.error(e)}try{navigator.mediaDevices.getUserMedia({video:{facingMode:l.facingMode}}).then(function(e){d.srcObject=e,d.setAttribute("playsinline",!0),d.play(),requestAnimationFrame(c)})}catch(e){console.error("Your browser does not support video"),console.error(e)}}}}();